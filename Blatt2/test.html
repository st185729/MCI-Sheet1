<!DOCTYPE html>
<html lang="">
<body>
<h1 id="title">User Study</h1>
<h2 id="instruction">Press space to start!</h2>
<div id="canvas"></div>
<p id="time"></p>
<p id="count"></p>
<p id="mean"></p>
<p id="sd"></p>

<canvas id="myCanvas" width="1500" height="630" style="border:0"></canvas>

<script>
    //for the rectangle
    const c = document.getElementById("myCanvas");

    // if true, the experiment is currently active
    let experimentActive = false;

    // if true, the stimulus is currently visible and the user should press space
    let stimulusIsVisible = false;

    // time at which the stimulus last appeared (in milliseconds, see Date.now())
    let stimulusTimestamp;

    // ID of the timeout that is scheduled to make the stimulus appear.
    // Used to cancel tests when the experiment ends.
    let testStimulusTimeout;

    // recorded reaction times in milliseconds
    let times = [];

    // DOM elements
    let timeElement = document.getElementById('time');
    let countElement = document.getElementById('count');
    let meanElement = document.getElementById('mean');
    let stdDevElement = document.getElementById('sd');
    let instructionElement = document.getElementById('instruction');

    function showStimulus() {
    var ctx = document.getElementById('myCanvas').getContext('2d');
    var cW = ctx.canvas.width, cH = ctx.canvas.height;
    var time = 0;
    var loop = 0;
    //var noOfLoops = 2;
    var timeMax = 500;
    var fTime = 0;
 
     function Fade(){
     
         this.render = function(fLength,fMaxAlpha,fIn,fInTime,fOutTime){

             if(fIn == true && fTime < fInTime){
                 var fAlpha = 0;
                 ctx.globalAlpha = fAlpha;
             } 
             else if(fTime >= fInTime && fTime <= fLength+fInTime){
                 var fAlpha = fMaxAlpha*(fTime-fInTime)/fLength;
                 ctx.globalAlpha = fAlpha;
             } 

             else if( fTime < timeMax) {
                 var fAlpha = fMaxAlpha;
                 ctx.globalAlpha = fAlpha;
             }
             
         }
     }
      
     var fade = new Fade();
     function Rect(rColor){
       
     
             if(rColor == 'red') {
                     rColor = 'red';
                 }
         this.render = function(rX,rY,rW,rH,fLength,fMaxAlpha,fIn,fOut,fInTime,fOutTime){
             
                 fade.render(fLength,fMaxAlpha,fIn,fOut,fInTime,fOutTime);
                 
                 ctx.fillStyle = rColor;
                 
                 ctx.fillRect(stimulusx, stimulusy, 150, 100);
                 ctx.globalAlpha = 1;
             }
             
     }
 
     function TimeLine(){
         this.render = function(){
              time+=1;
              fTime++;
         }
     }
     var color = 'red';
     var timeLine = new TimeLine();
     var rect = new Rect(color);
     const stimulusx = Math.random()*1400;
    const stimulusy = Math.random()*500;
   
     function animate() {
 
         ctx.save();
         ctx.clearRect(0, 0, cW, cH);
         timeLine.render();
         ctx.fillStyle = '#fff';
         ctx.fillRect(0, 0, cW, cH);
 
         
         rect.render(0,0,200,200,700,1,true,false,50,0);
         
         
     }
     var animateInterval = setInterval(animate, 15);
    }


    function FadeIn() {
        document.getElementById("image").classList = 'animate';
    }

function startTestTrial() {
    // reset the stimulus
    setStimulusColor('black');
    stimulusIsVisible = false;

    // schedule the stimulus to appear after a random amount of time
    let timeToWaitInSeconds = Math.random() * 4 + 2; // 2 - 6s
    testStimulusTimeout = setTimeout(showStimulus, timeToWaitInSeconds * 1000);
}


function recordStimulusReactionTime() {
    let deltaTime = Date.now() - stimulusTimestamp;
    times.push(deltaTime);
    timeElement.textContent = deltaTime + ' ms';
}
    
function startExperiment() {
    clearResults(); // clear results of any previous tests
    instructionElement.textContent = "Press space when the color changes! Press 'a' for results!";

    // reset data and start tests
    times = [];
    experimentActive = true;
    startTestTrial();
}

function stopExperiment() {
    // cancel any ongoing tests
    clearTimeout(testStimulusTimeout);
    stimulusIsVisible = false;
    experimentActive = false;

    // reset instruction and show results
    instruction.textContent = 'Press space to start!';
    showResults();
}
    window.addEventListener('keydown', (event) => {
        if(event.key ===' '){
        // the user pressed the space key
        if (!experimentActive) {
            // start the experiment if it wasn't active
            startExperiment();
            return;
        } else if (!stimulusIsVisible){
            stopExperiment();
        }

        if (stimulusIsVisible) {
            // record reaction time
            recordStimulusReactionTime();
            // start next trial
            startTestTrial();
        }
    } else if (event.key === 'a') {
        if (experimentActive) {
            // stop the experiment and show results
            stopExperiment();
        }
    }
    });
</script>

</body>
</html>